<div class="container-fluid content-wrapper">
  <h1 class="page-title">Устранение неопределенности (унификация)</h1>
  <div class="callout-message-wrapper">
    <div class="callout-icon">
      <i class="fas fa-info-circle"></i>
    </div>
    <div class="callout-message">
      <span>
        Рейтинги используют неоднозначные и не всегда точные названия организаций.
        Мы используем таблицу приведения названий в рейтингах к единому написанию и <a
          href="https://developers.google.com/cloud-search/docs/guides/project-setup">Google search API</a>.
          <p>Загружено {{ udmCount }} организаций до унификации названий.</p>
          <p>Необходимо устранить многозначность у {{unDisambCount}} организаций.</p>
      </span><br />
    </div>
  </div>
  <div class="col-sm-12 col-md-8" *ngIf="unDisambCount != 0">
    <label for="labelOnTop" class="col-form-label">Укажите <a href="https://developers.google.com/custom-search/v1/introduction/?apix=true">Google Search API Key</a></label>
    <input type="text" class="form-control" id="labelOnTop" placeholder="Google search API" [(ngModel)]="apiKey">
    <button type="button" class="open-button" (click)="prepare()" [disabled]="service.rankDataCount == 0">Загрузить данные Google для унификации</button>
  </div>
  <div class="col-sm-12 col-md-8" *ngIf="disambjson">
    <label>Добавьте полученные данные в файл /src/assets/data/compare/disamb.json</label>
    <textarea type="text" class="form-control" id="labelOnTop" placeholder="disamb.json" [(ngModel)]="disambjson" #userinput></textarea>
    <button type="button" class="open-button" (click)="copyInputMessage(userinput)">Скопировать данные</button>
  </div>
  <div class="col-sm-12 col-md-8" *ngIf="unDisambCount != 0">
    <label for="labelOnTop" class="col-form-label">Заключительный этап</label>
    <button type="button" class="open-button" (click)="nextStep()">Унифицировать данные</button>
  </div>

  <div class="table-wrapper table-responsive">
    <table mat-table #table class="table table-borderless" [dataSource]="dataSource" matSort #sort="matSort">

      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()"
            (change)="$event ? showSelected() && selection.toggle(row)  : null" [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="url">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Url </th>
        <td mat-cell *matCellDef="let row"> {{row.url}} </td>
      </ng-container>

      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Rating </th>
        <td mat-cell *matCellDef="let row"><a target="_blank" href="{{row.url}}">{{row.rating}}</a></td>
      </ng-container>

      <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Year </th>
        <td mat-cell *matCellDef="let row"> {{row.year}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)">
      </tr>
    </table>
  </div>
</div>